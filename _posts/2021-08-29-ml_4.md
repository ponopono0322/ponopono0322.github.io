---
title:  "[ML]제주도 여행지 추천 모델 제작-4"
excerpt: "전처리와 Word2Vec"

categories:
  - Blog
tags:
  - [ML, KoNLPy, Cosine similarity, Max score tokenizer, Word2Vec, Soynlp]

toc: true
toc_sticky: true
 
date: 2021-08-29
last_modified_at: 2021-08-29
---
# 시작하기 앞서
## 지난 포스트 요약
1. 크롤링을 하게 된 이유
2. 각종 사이트로부터 크롤링

## 이번 포스트에서는
크롤링한 데이터를 어떻게 수치화 시켰는지 다룹니다.

1. 어떤 라이브러리를 사용했는가?
2. 단어간 유사도를 알아낼 수 있을까?
3. 한국어 단어 나누기
4. 형태소 분석기 사용하기
5. 다음 이야기

# 1. 어떤 라이브러리를 사용했는가?
이번 포스트에서 사용한 라이브러리는 다음과 같습니다.
1. KoNLPy
2. Soynlp
3. Scikit-learn
4. Pandas
5. Numpy

# 2. 단어간 유사도를 알아낼 수 있을까?
## 어떤 방식으로 단어의 유사도를 알아낼까?
한 문장 내에 나오는 단어들을 모두 원핫인코딩 형태로 나타내게 되면, 서로간의 유사도를 판별할 수 없다. 원핫인코딩은 0과 1로만 표현되기 때문이다.    
그렇기 때문에 사용자가 원하는 행렬공간을 입력하고, 컴퓨터가 그 공간안에서 문장내 단어의 거리를 숫자로 나타내는 방식을 사용한다.

## Word2Vec의 CBOW와 Skip-gram 방식
한줄로 요약하자면 CBOW는 주변단어로 원하는 단어를 유추하는것, Skip-gram은 원하는 단어로 주변단어를 유추하는 것이다.   
우리는 장소와 그 장소의 대표할 만한 단어들을 찾아내는 것이므로 Skip-gram 방식을 사용하기로 했다.

## 코사인 유사도
코사인 유사도는 두 벡터 간의 코사인 각도를 통해 -1 ~ 1 사이의 값으로 출력하는 것이다. 당연하겠지만 1에 가까울수록 유사도가 높음, -1에 가까울수록 유사도가 낮음을 나타낸다. 문장에서는 단어의 등장횟수를 배열로 만들어 두 문장을 비교하는 방식이다. 이 부분은 추후에 비슷한 음식점을 찾는 알고리즘에 사용되었다.

## Max score tokenizer
사용자가 단어의 길이를 정해, 컴퓨터가 그 길이만큼 문장을 나눠 빈도수가 높은 묶음에 점수를 줘 문장을 나눠주는 방식이다. 이 방식은 인스타그램 해시태그 나누는 방식에 사용되었으나, 최종적으로 해시태그 분류에 한나눔 분석기를 채용해서 최종결과물에 사용되지 못했다. 그리고 이 부분은 다른 팀원이 담당했기 때문에 본 포스트에서는 코드를 다루지 않는다.

# 3. 한국어 단어 나누기
그러니까, 단어와 단어 사이의 거리를 숫자로 나타내주는 Word2Vec을 쓰려면 가장 먼저 필요한 것이 단어라는 결론을 얻을 수 있었다.   
문장을 나누고 단어 배열을 얻으면 된다.

## 영어와 다른 한국어
Word2Vec를 찾아보면서 가장 어려웠던 부분은 영문으로 된 예제 자료였다. 보통 영어는 전처리 과정에서 대문자를 소문자로 바꾸기, 관사 처리하기 등 완벽하게 한국어에는 없는 행위들을 했다. 특히나 영어의 경우 띄어쓰기를 하지 않으면 읽히지 않는 경우가 많기 때문에 띄어쓰기로만으로도 단어 나누기가 잘 나눠진다. 하지만 한국어의 경우 대문자,소문자 개념도 없는데다 띄어쓰기를 안했어도 문장이 읽히고, 극단적으로 한국인은 인터넷에 떠도는 다음과 같은 문장도 읽을 수 있다!

"이말거고 지처금럼 네짜글씩 순바서꿔 써도해도요. 이하상게 한인국은 읽수을가 있든거요."   
"한꾹인뜰만알아뽈쑤있께짝썽하껬씁니따. 쩔때 여끼로오찌마쎄요"

이렇기 때문에 한국어는 한국어만의 전처리 과정을 나눠야 했다. 이 프로젝트를 수행할 당시, 카카오 형태소 분석기를 비롯한 여럿 분류기가 있음을 확인했으나 설치문제 등의 이유로 KoNLPy 내 라이브러리를 사용하기로 했다.

## KoNLPy
KoNLPy에서는 다양한 방식을 사용해 띄어쓰기 없이도 한국어를 나눌 수 있도록 지원한다. 각각의 형태소 분석기마다 고유의 사전을 통해 단어집을 기반으로 단어들을 나누게 된다. 구글에 '형태소 분석기 비교'라고 검색을 하게 되면 수 많은 비교분석 글들이 나오니 참고하면 되겠다. 그 중 우리는 Okt(twiiter) 분석기를 주로 사용했다. 사용한 이유로는 블로그 리뷰이기 때문에 신조어, 불완벽한 띄어쓰기와 맞춤법을 정규화 처리해야하기 때문이다. 아쉬운 점이라면 나누지 말아야할 불용어 사전을 따로 만들어내지 못한 것이다. 이 부분 때문에 생긴 문제들도 있었는데, 포스트 중간중간에 대안으로 한 방법들에 대해 설명한다.

# 4. 형태소 분석기 사용하기
## Okt(twitter) 분석기
일단 블로그 글의 특성을 이해할 필요가 있었다. 블로그의 글들을 보게 되면, 한 줄을 꽉 채워 쓰는 경우가 드물다. 한 줄에 보통 10단어 이내, 흔히 3~8 단어로 이뤄지고, 문장의 끝을 나타내는 마침표(.)가 없는 경우가 대부분이다. 그렇다고 블로그 전체 내용을 한 문장으로 보는 것도 어렵기 때문에 줄바꿈(\n)을 기준으로 나눴다. 이렇게 나뉜 문장들을 정규화 처리한 후, 분석기에 넣고, 명사만 추출하여 배열로 만들어 냈다.

명사만 추출하게 된 이유도 한국어 특성이 들어가 있다.

<script src="https://gist.github.com/ponopono0322/8df5fc47bae1d726afbc1ef8379fae06.js"></script>

위의 코드를 실행하게 되면 다음과 같이 결과가 나올 것이다.

[('얼마', 'Noun'), ('전', 'Noun'), ('지인', 'Noun'), ('들', 'Suffix'), ('과', 'Josa'), ('함께', 'Adverb'), ('모여', 'Verb'), ('꼭', 'Noun'), ('가보고', 'Verb'), ('싶었던', 'Verb'), ('법환', 'Noun'), ('포구', 'Noun'), ('맛집', 'Noun'), ('을', 'Josa'), ('다녀오게', 'Verb'), ('되었어요', 'Verb'), ('.', 'Punctuation')]

이 중 명사만 빼보면 다음과 같다.

얼마, 전, 지인, 꼭, 법환, 포구, 맛집

원문인 '얼마전 지인들과 함께 모여 꼭 가보고 싶었던 법환포구 맛집을 다녀오게 되었어요.' 비교했을 때 명사만 추출해도 어느정도 이해가능하다.    
그래서 우리는 명사만 추출해서 명사배열을 만들기로 했다.

<script src="https://gist.github.com/ponopono0322/21f1b50d7acc5d5b1c65f3a4c604c163.js"></script>

우선 이전에 만들어두었던 블로그 크롤링데이터를 데이터프레임으로 가져온 후, 앞서 말한 과정(정규화, 명사만 추출)을 수행했다.   
이렇게 생성된 배열을 Word2Vec에 적용하는데, 이 작업은 다음 포스트에서 하겠다.

## 해시태그 단어를 나누기 위한 다른 분석기 사용
인스타그램의 해시태그는 상당히 모호한 부분이 많았다. 우선 해시태그는 띄어쓰기가 안 되어있고, ~으로가는길, ~가는중만난 등의 필요한 것 같으면서 필요없는 부분이 많았다. 그렇기 때문에 어느부분에서 나눌지 고민을 많이했고, 일단 모든 분석기를 사용한 뒤에 그나마 잘 나눠진 분석기를 채용하는 방식으로 진행됐다.

그렇게 쓴 분석기는 Kkma, Hannanum, Okt였고, 각 분석기를 통해 얻은 결과는 아래와 같았다.

예문: 하모해변에서서귀포항까지45km

1. Kkma: 하모해변,에서,스,어,귀,포항,까지,45,km
2. Hannanum: 하모해변,에서,서귀포항까지45km
3. Okt: 하모해변,에서,서,귀,포항,까지,45,km

서귀포라는 단어는 나눠지면 안되므로 한나눔 분석기가 그런 부분에서 다른 분석기보다 좋다는 것을 알아내어 해당 방식을 사용하게 되었다.

## 코사인 유사도
코사인 유사도를 쓴 부분은 음식점 해시태그였다. 리뷰를 통해 얻어낸 해시태그들과 사용자가 원했던 해시태그와 유사도를 따져 최상의 결과를 내도록 하는 것이였다. 나름의 가중치를 주기 위해 리뷰평점과 등록리뷰수를 포함하여 해시태그 유사도를 보여주었다.

구하는 과정은 다음과 같았다.
1. 비짓제주의 음식점 데이터
2. 트립어드바이저의 음식점 리뷰 데이터
3. 트립어드바이저의 음식점 정보 데이터
4. 1과 3의 데이터를 합치고(1), 2의 리뷰 평점과 수를 (1)과 합쳤다.

<script src="https://gist.github.com/ponopono0322/9b5eba5c1c2124f5709cf3515848c04b.js"></script>

결과를 얻고 싶으면 위 코드에 마지막에 find_simi_place(df, place_simi_co_sorted_ind, 찾고자하는 음식점이름, 5) 추가하여 상위 결과를 얻을 수 있다.

# 5. 다음 이야기
네이버 블로그의 경우 Okt 분석기를 통해 배열을 만들었고, 인스타그램 해시태그는 Hannanum분석기를 이용해 해시태그를 나눌 수 있었고, 트립어드바이저의 리뷰 및 정보 데이터는 코사인 유사도를 사용하여 비슷한 음식점을 찾아보는 예시를 보여주었다.

다음 포스트에서는 Okt 분석기를 거친 배열을 Word2Vec에 넣고 유사도를 측정하는 법, 나온 유사도를 어떻게 활용했는지, 사용자의 개인 태그와 어떻게 매칭했는지, 인스타그램 해시태그와 음식점 매칭은 어떻게 했는지를 다룹니다.
