---
title:  "[ML]제주도 여행지 추천 모델 제작-2"
excerpt: "제주도 행정구역별 카드매출, 그리고 시각화"

categories:
  - ML
tags:
  - [ML, Selenium, geopandas, Folium]

toc: true
toc_sticky: true
 
date: 2021-08-26
last_modified_at: 2021-08-28
---
# 시작하기 앞서
## 지난 포스트 요약
1. 제주도 한정 여행지 추천모델 선정 과정
2. 공공데이터포털, 제주데이터허브로 부터 데이터 수집

## 이번 포스트에서는
공공데이터를 수집하고, 수집된 데이터를 기반으로 데이터 탐색을 다룹니다.

1. 어떤 데이터를 수집했는가?
2. 어떤 라이브러리를 사용했는가?
3. 어떤 방식으로 진행했는가?
4. 결론
5. 다음 이야기

# 1. 어떤 데이터를 수집했는가?
## 제주데이터허브 데이터 수집과정
![Screenshot 2021-08-26 at 14-41-37 제주데이터허브](https://user-images.githubusercontent.com/32767165/130907505-c97893ae-389e-42f5-95c4-d22c27993e67.png)


제주데이터허브에서 상단 빨간 박스부터 차례로 클릭하여 나온 순서대로 모든 데이터를 다운로드 했다.

## 공공데이터포털 데이터 수집과정
![그림2](https://user-images.githubusercontent.com/32767165/130908017-dcda3ff6-e597-481b-b5a6-7e7b8a999ecb.png)


공공데이터포털에서 '제주특별자치도' 라는 키워드로 수정일 - 40개씩 보이기 정렬을 수행하여 현수막 위치, 부동산 중개업소 정보같은 여행과 상관성이 낮은 항목들과 수정일자가 21년이 아닌 항목들은 빼고 수집하였다.

## 어떤 데이터를 사용할까?
교육 프로그램 동안 배운 내용을 기반으로 추측하건데, 전통적 머신러닝은 문자 데이터보다는 숫자데이터를 좋아한다. 통계니까 당연한 이야기 일 수 있겠다.   
무튼 feature 값도 많지 않게(대략 10개 이내 인 것 같았다) 6 ~ 8 사이 정도에, 입력값과 출력값이 명확하고, 선형성을 그려낼 수 있는 것이 이상적인 데이터셋이다.

개인적인 생각에 비춰볼때 가장 이상적인 자료는 신용카드 데이터, 버스 이용량(혹은 정류장별 wifi 접속량)이였다.   
당연하겠지만 구글링을 하며 알아낸 결과, 대부분의 머신러닝으로 유동인구, 장소추천 모델 구현 베이스 데이터는 신용카드, 이동전화 기지국 접속량이였다.

그러니까 이미 모델 구축이 완료 됐기 때문에 공공데이터로 깔끔하게 정제된 데이터를 개방한 것 아닐까? 라는 생각이 들었던 한편, 제대로 길을 가고 있구나라는 안심을 얻게 되었다.

# 2. 어떤 라이브러리를 사용했는가?
## 본 포스트에서 사용한 라이브러리들
1. pandas
2. numpy
3. matplotlib
4. folium
5. plotly
6. geopandas
7. json

csv와 excel 파일을 읽기 위해 데이터프레임을 제공하는 pandas, 숫자 데이터 다룰 때 자주 쓰는 numpy, 표 그리는 matplotlib과 plotly 그리고 지도에 나타낼 plotly를 사용했다.

## 행정구역 나누기
일단 행정구역을 나누려면 위경도 데이터가 필요했다.   
국가공간정보포털(http://www.nsdi.go.kr/lxportal/?menuno=2679)에서 제주도의 면읍동 행정구역의 위경도 데이터를 다운 받았다.   
shp파일을 자체적으로 사용할 수 없고, geoJson으로 변환하는 작업을 거쳐야 사용할 수 있다고 하여 찾아본 결과   
이 사이트(https://mjs1995.tistory.com/169)에서 시도한 방법으로 성공했다.

# 3. 어떤 방식으로 진행했는가?
## 사람들이 많이 다닌 곳이 유명한 곳 아닐까?
"대중교통을 이용해 여행하는 사람도 많을테니, 버스 와이파이 사용량을 보면 알 수 있지 않을까?" 라는 생각으로 출발해, 해당 데이터를 찾아보았다. 

<img width="735" alt="캡처" src="https://user-images.githubusercontent.com/32767165/130924168-2391372d-6441-4ce0-bdcd-56fc13f85cdd.PNG">

결과만 놓고 보자면, 살짝 불안했다. 이유로는
1. 40~50대에 데이터가 쏠려있다.
2. 성별도 남성에 쏠려있다.
3. 방문타입에 대한 정확성이 떨어지는 것 같았다.

데이터를 그대로 믿고 가기에는 살짝 불안했다. 그리고 신용카드 데이터를 보고 무엇이 문제였는지 알 수 있었다.

## 사람들이 쓴 돈으로 핫플레이스를 구별할 수 있지 않을까?
실제로 상권분석할 때, 핫플레이스 예측할 때 자주 쓰이는 것이 카드매출 자료이다.   
제주도 역시 BC카드와 협업해서 빅데이터센터를 구축한 것으로 보였다.  
그래서인지 카드 매출 비교에 관한 csv파일을 쉽게 얻을 수 있었는데(찾아보니 실제로 카드회사들은 신용카드 사용에 관한 데이터를 팔고 있었다!), 굉장히 정제가 잘 되어 보였다.

<img width="720" alt="1" src="https://user-images.githubusercontent.com/32767165/130944483-956bac20-6ab4-481a-a333-095deb2e9854.PNG">

데이터는 위와 같이 되어 있었는데, 업종별로 나눠도 잘 나올 것 같았고, 각 동별로 나눠도 잘 나올 것 같았다.

## 업종명으로 나눠볼까?
```python
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
from matplotlib import font_manager, rc
font_path = "C:/Windows/Fonts/NGULIM.TTF"
font = font_manager.FontProperties(fname=font_path).get_name()
rc('font', family=font)

plt.figure(figsize = (20,20))
mmd.sort_values().plot(kind='barh')
plt.title('지역별 운송업 매출 비교')
plt.xlabel('매출')
plt.ylabel('지역')
plt.show()
```

x축은 업종, y축은 각 지역으로 구분해서 나눠보았다.   
값이 없는데도 가장 상단에 나오는 행정구역은 nan 값이였다.

### 서비스업 매출 순위
![지역별 서비스업 매출 비교](https://user-images.githubusercontent.com/32767165/130945430-1eb9e190-1688-40d9-9937-b67d551fbcf2.png)
### 소매업 매출 순위
![지역별 소매업 매출 비교](https://user-images.githubusercontent.com/32767165/130945526-5a66e86f-432d-4654-b7fe-24e7b46baa90.png)
### 숙박업 매출 순위
![지역별 숙박업 매출 비교](https://user-images.githubusercontent.com/32767165/130945560-832d2e78-60b1-4b4a-a158-8ff99b0f977b.png)
### 음식점업 매출 순위
![지역별 음식점업 매출 비교](https://user-images.githubusercontent.com/32767165/130945583-d05fa8e3-92e1-4811-8302-19d51ab74836.png)
### 임대업 매출 순위
![지역별 임대업 매출 비교](https://user-images.githubusercontent.com/32767165/130945618-4cbc1c23-93fd-4d11-81b1-fc35aae27829.png)

느낌이 안 좋다. 각 업종별로 다른 동들이 나올 줄 알았는데, 결과를 보니 대부분 연동과 그 근처에 몰려있다.   
그리고 각 동별로 편차가 매우 심하다. 매출이 가장 높은곳과 낮은곳의 차이가 너무 크다.   
folium으로 지도 시각화해서 보는 것보다 표로보는 것이 더 체감이 클 것 같아 표로 올렸다.

왜 이렇게 됐을까?

## 왜 데이터가 쏠렸을까?
왜 데이터가 쏠렸는지 '연동'을 검색해 보았다. 그리고 금방 그 이유를 알 수 있었다.

### 첫번째 이유: 공항
제주도가 섬이라 입구 출구가 정해져 있다. 공항 또는 항구인데, 대부분 비행기를 타고 제주도로 들어오게 된다.   
그리고 그 공항은 '용담이동'에 있다.

<img width="711" alt="2" src="https://user-images.githubusercontent.com/32767165/130947476-5c27814d-d9a0-4844-8a57-647f681010fc.PNG">

네이버 지도에서 금방 확인 할 수 있다. 용담1,2동, 연동, 일도1,2동, 이도1,2동, 삼도1,2동 모두 그 근방이다.

그리고 위와 비슷한 이유로 관광객 소비 매출이 높은 구역은 면세점이 있는 곳이였다.

### 두번째 이유: 제주도 내수시장  
당장 네이버에 제주도 인구수라고 쳐봐도 공항이 포함된 제주시가 서귀포시보다 2배보다 많은 인구를 보유하고 있다. 즉, 제주공항이 있는 곳에 사람이 많이 산다.   
관광객의 매출을 비교하기 이전에, 이미 제주 내 내수시장이 용동 쪽으로 몰려있다는 것을 알았다.


### (번외) 버스정류장 이용객수에 대한 데이터를 통한 확신
<img width="230" alt="캡처" src="https://user-images.githubusercontent.com/32767165/130963400-6a4a4774-aab8-4e53-ae25-f2d1faa7a485.PNG">

버스정류장 데이터를 보게 되면 위 이미지와 같게 대부분 학교근처 정류장이 무조건 상위권이다.   
이러한 데이터 쏠림 현상을 추론한 내용으로
1. 관광객이 대부분 차량을 렌트하여 다니므로 관광객의 버스 이용량이 적으며
2. 버스를 이용하는 주체가 대부분 학생이므로 특히나 학교 주변 정류장으로 데이터 쏠림 현상이 났고
3. 일반적으로 대학 주변 상권이 발달되어 유동인구도 많다.

가 있었다.

# 4. 결론

## 행정구역 선구분 후 스팟 추천은 데이터 쏠림 현상이 분명하다.
우리가 원하는 결과는 일반적인 핫플레이스 추천이 아니라 '개인맞춤'에 강해, '대개 이런 흐름을 갖는다'라는 선형적인 결과를 내는 회귀 머신러닝 적용이 힘들었다.   
예를 들자면, A, B라는 여행자가 있는데, A는 관람하는 것을 우선적으로 보고 싶어하고, B는 먹는 것을 우선적으로 여긴다.   
공통적으로 A,B에게 추천하기 위해선 핫플레이스, 즉 매출이 높거나 버스이용량이 많은 곳으로 추천해주기 마련이다.   
그러나 쏠린 데이터 때문에 둘 다 특정 행정구역을 지목하고, 그 지역 내에서 유명한 명소와 음식점을 추천하게 된다.

다시 말하자면, 사용자가 무슨 값을 입력헤도 현재의 방식을 적용한다면 같은 읍면동 내의 장소를 추천할 것이다.

## 좌표 기준으로 하는 경로 추천 알고리즘을 구현해야 할까?
설사 해결책을 찾아 고르게 분포하도록 설계했다 하더라도 두번째 문제가 있었다.   
경로 추천 알고리즘을 적용해야 했다.   
극단적인 예시로, 아침에 방문한 관광지는 서쪽 끝에 있고, 점심식사를 위해 동쪽 끝으로 가는 것은 비효율적이지 않을까?   
관광지 - 음식점 - 관광지 순서로 방문할 때 그들의 거리가 어느정도 뭉쳐있어야 했다.   
우리의 목적은 머신러닝 모델을 만드는 것이지, 최적화 알고리즘을 구하는 프로젝트가 아니였기 때문이다.

## 올레 n번 길은 어떻게 표현해야 할까?
제주도만의 특징으로, 해안가를 따라 걷는 트래킹 코스들이 많다. 그리고 언제든지 중간에 빠져나올 수 있다.   
이것이 어떤 문제를 갖고 있었냐면, 시작점과 끝점이 다르다는 것이다.   
oo수목원이나 oo박물관 같은 장소들은 한정된 공간안에서 관람을 즐겼다면, 그 곳에서 나와 다른 곳에 가도록 되어있다.

트래킹은 이와 다르게 여행자가 걸어다니는 것이라 시작한 위치도 자유롭고 끝내는 위치도 자유롭다. ML적인 요소로 보자면, label 값이 널뛸 수 있다.   
예시로, 올레길 1-1번길과 1-3번길은 부모님과 같이 가면 좋은곳, 1-2번길은 연인과 같이 가면 좋은 곳이라고 구성되어 있다 치자.   
상식적으로 생각해도 1-1과 1-2는 별반 차이가 없을 것이고, 두 길 사이의 거리차이도 많지 않을 것인데    
1-1번길만 둘러보고 끝내거나 거리에 의해 1-2만 빼고 1-1,1-3번길을 추천하는 것은 지나친 오류이다.

## folium으로도 보기 힘든 위경도 차이

```python
from folium.plugins import MarkerCluster
map1 = folium.Map(location=[33.389548, 126.239267],zoom_start=15)
mc = MarkerCluster().add_to(map1)
def mydef(array, i):
    data = pd.read_csv(array, encoding='cp949')
    
    if i == 37:
        data['장소명'] = '관람길'
    Ldata = data[['위도','경도','장소명']]
    
    mc = MarkerCluster().add_to(map1)
    
    for idx, row in Ldata.iterrows():
        loc = [row[0],row[1]]
        folium.Marker(loc, popup=row[2]).add_to(mc)
for i in range(1,52):
    st = "C:/Users/dwshi/Downloads/제주/csv파일/52곳/"+str(i).zfill(3)+"-2.csv"
    mydef(st, i)
    
map1
```

<img width="706" alt="1" src="https://user-images.githubusercontent.com/32767165/130969504-3f8ad04c-0830-483a-b4cf-6d6ce9c1cc9f.PNG">

<img width="703" alt="2" src="https://user-images.githubusercontent.com/32767165/130969537-acb65652-0a3b-4f89-8b9a-99db9d11f5f5.PNG">

조사원이 돌아다니며 장소별 특징을 정리한 파일도 있었기 때문에 이것을 folium으로 시각화 했었다.   
첫번째 사진은 위경도 차이가 크지 않은 탓에 각각 따로 나오는 것이 아니라 공통부분을 묶어서 표현해버렸다.   
이것이 제주도 내 모든 업장으로 변경되도 같은 현상을 보일 것이다. 이 문제는 경로 추천 문제와 겹치게 됐다.

# 5. 다음 이야기
여러 문제점을 안고 가기에 리스크가 크므로 다른 방안을 찾아보게 되었다.   
멘토링에서도 나온 이야기로, 연관분석이나 Word2Vec을 쓰는 것이 어떻냐는 것이였다.